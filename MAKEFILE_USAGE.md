# Makefile ä½¿ç”¨æŒ‡å—

## ç®€ä»‹

è¿™ä»½æŒ‡å—è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ä¸ºé—²é±¼çˆ¬è™«é¡¹ç›®åˆ›å»ºçš„Makefileï¼Œå®ƒåŒ…å«äº†å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²çš„å¸¸ç”¨å‘½ä»¤ã€‚

## å¿«é€Ÿå¼€å§‹

### 1. é¦–æ¬¡è®¾ç½®

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼ˆæ ¹æ®éœ€è¦ä¿®æ”¹ï¼‰
nano .env

# å®‰è£…å¼€å‘ç¯å¢ƒä¾èµ–
make install-dev
```

### 2. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼ï¼ˆå¸¦çƒ­é‡è½½ï¼‰
make dev

# ç”Ÿäº§æ¨¡å¼
make run
```

## å¸¸ç”¨å‘½ä»¤è¯¦è§£

### ğŸ”§ å¼€å‘å‘½ä»¤

| å‘½ä»¤ | æè¿° |
|------|------|
| `make install` | ä»…å®‰è£…ç”Ÿäº§ç¯å¢ƒä¾èµ– |
| `make install-dev` | å®‰è£…å®Œæ•´çš„å¼€å‘ç¯å¢ƒï¼ŒåŒ…æ‹¬æµ‹è¯•å·¥å…·ã€æ ¼å¼åŒ–å·¥å…·ç­‰ |
| `make dev` | å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒçƒ­é‡è½½ï¼ˆä¿®æ”¹ä»£ç è‡ªåŠ¨é‡å¯ï¼‰ |
| `make run` | å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨ |

### ğŸ§ª æµ‹è¯•å‘½ä»¤

```bash
# è¿è¡ŒåŸºç¡€æµ‹è¯•
make test

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼ˆhtmlcov/ç›®å½•ï¼‰
make test-cov

# æ£€æŸ¥ä»£ç è´¨é‡
make lint
```

### ğŸ¨ ä»£ç æ ¼å¼åŒ–

```bash
# æ ¼å¼åŒ–ä»£ç ï¼ˆè‡ªåŠ¨ä¿®å¤ï¼‰
make format

# ä»…æ£€æŸ¥æ ¼å¼ï¼ˆä¸ä¿®æ”¹ï¼‰
make format-check
```

### ğŸ—„ï¸ æ•°æ®åº“ç®¡ç†

```bash
# æ˜¾ç¤ºæ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
make db-stats

# é‡ç½®æ•°æ®åº“ï¼ˆè­¦å‘Šï¼šä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
make db-reset
```

### ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²

```bash
# æ„å»ºDockeré•œåƒ
make docker-build

# è¿è¡ŒDockerå®¹å™¨
make docker-run

# åœæ­¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨
make docker-stop
```

### ğŸ› ï¸ ç³»ç»Ÿç»´æŠ¤

```bash
# å‡çº§æ‰€æœ‰ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬
make deps-upgrade

# æ¸…ç†ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶
make clean

# åˆ›å»ºç¯å¢ƒå˜é‡æ¨¡æ¿
make setup-env
```

## å®é™…ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯1ï¼šæ–°é¡¹ç›®è®¾ç½®

```bash
git clone <repository>
cd xianyu_spider

# ä¸€æ­¥åˆ°ä½è®¾ç½®ç¯å¢ƒ
make setup-env
# ç¼–è¾‘ .env æ–‡ä»¶é…ç½®
make install-dev

# é¦–æ¬¡æµ‹è¯•
make health    # ç¡®è®¤æœåŠ¡èƒ½æ­£å¸¸å¯åŠ¨
make api-test  # æµ‹è¯•APIæ¥å£
```

### åœºæ™¯2ï¼šæ—¥å¸¸å¼€å‘æµç¨‹

```bash
# æ¯å¤©æ—©ä¸Šæ›´æ–°ä¾èµ–
make deps-upgrade

# å¼€å§‹å¼€å‘å‰æ£€æŸ¥
make format-check
make lint
make test

# ä¿®å¤æ ¼å¼é—®é¢˜
make format

# å¯åŠ¨å¼€å‘æœåŠ¡
make dev
```

### åœºæ™¯3ï¼šéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

```bash
# æ¸…ç†ç¯å¢ƒ
make clean

# åŸºç¡€å®‰è£…
make install

# å®¹å™¨åŒ–éƒ¨ç½²
make docker-build
make docker-run
```

## æ•…éšœæ’é™¤

### Q: æµè§ˆå™¨å®‰è£…å¤±è´¥
```bash
make playwright-install
```

### Q: ç¯å¢ƒé…ç½®é—®é¢˜
```bash
# é‡æ–°è®¾ç½®ç¯å¢ƒ
make setup-env
# æ£€æŸ¥å½“å‰ç¯å¢ƒ
cat .env
```

### Q: æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨
lsof -i :8000

# æ¸…ç†å¹¶é‡è¯•
make clean
make setup-env
make install-dev
make dev
```

### Q: æƒ³è¦æµ‹è¯•API
```bash
# ä½¿ç”¨å†…ç½®æµ‹è¯•å‘½ä»¤
make api-test
# æŒ‰æç¤ºè¾“å…¥å…³é”®è¯å’Œé¡µæ•°
```

## ç›‘æ§å’Œæ—¥å¿—

### æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
make health
```

### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```
make logs
```

### æ•°æ®åº“ç»Ÿè®¡
```bash
make db-stats
```

## ç¯å¢ƒå˜é‡è¯´æ˜

ç¼–è¾‘ `.env` æ–‡ä»¶å¯ä»¥é…ç½®ä»¥ä¸‹è®¾ç½®ï¼š

- **æ•°æ®åº“**: æ”¯æŒ SQLite/MySQL/PostgreSQL
- **æœåŠ¡å™¨**: HOST å’Œ PORT é…ç½®
- **çˆ¬è™«**: å»¶è¿Ÿæ—¶é—´ã€æ— å¤´æ¨¡å¼å¼€å…³
- **æµè§ˆå™¨**: è‡ªå®šä¹‰ User-Agent
- **ä»£ç†**: é…ç½®ä»£ç†æœåŠ¡å™¨

## æœ€ä½³å®è·µ

### å¼€å‘é˜¶æ®µ
1. ä¿æŒ `make format && make lint && make test` æµç¨‹
2. ä¿®æ”¹ä»£ç ååŠæ—¶æ ¼å¼åŒ–
3. ä½¿ç”¨ `make dev` è¿›è¡Œå¼€å‘ï¼Œé¿å…ç›´æ¥è¿è¡Œè„šæœ¬

### éƒ¨ç½²é˜¶æ®µ
1. æ¸…ç†å¼€å‘æ–‡ä»¶ï¼š`make clean`
2. ä½¿ç”¨å®¹å™¨åŒ–éƒ¨ç½²ï¼š`make docker-build && make docker-run`
3. å®šæœŸæ£€æŸ¥å®‰å…¨æ›´æ–°ï¼š`make deps-upgrade`

### åä½œè§„èŒƒ
- æäº¤å‰è¿è¡Œ `make test` ç¡®ä¿æµ‹è¯•é€šè¿‡
- ä¿æŒä»£ç æ ¼å¼ç»Ÿä¸€ï¼š`make format`
- æ›´æ–°ä¾èµ–è®°å½•åˆ° `requirements.txt`

## è¿›é˜¶å‘½ä»¤

### è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
```bash
# ä½¿ç”¨è‡ªå®šä¹‰ç«¯å£å¯åŠ¨
SERVER_PORT=3000 make dev

# ä¿®æ”¹ä¸»æœºç»‘å®š
SERVER_HOST=localhost make dev
```

### è°ƒè¯•æ¨¡å¼
```bash
# è®¾ç½®è°ƒè¯•æ¨¡å¼
DEBUG=true make dev
```

### ä»£ç†é…ç½®ç¤ºä¾‹
```bash
# åœ¨ .env æ–‡ä»¶ä¸­æ·»åŠ ï¼š
# HTTP_PROXY=http://127.0.0.1:8080
# HTTPS_PROXY=http://127.0.0.1:8080
```

## å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

è¿™ä¸ªMakefileæ—¨åœ¨ç®€åŒ–å¼€å‘æµç¨‹ï¼Œå¦‚æœé‡åˆ°é—®é¢˜å¯ä»¥è¿è¡Œ `make help` æŸ¥çœ‹å¯ç”¨å‘½ä»¤ï¼Œæˆ–å‚è€ƒé¡¹ç›®README.mdè·å–æ›´å¤šä¿¡æ¯ã€‚